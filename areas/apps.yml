---
- name: install apps
  hosts: all

  tasks:
  - name: update pacman.conf
    template: src=templates/pacman.conf dest=/etc/pacman.conf owner=root group=root mode=0644
    notify: update pacman caches
  - meta: flush_handlers

  - name: install common packages
    pacman: name={{ item }}
    with_items:
    - brasero
    - cups
    - gimp
    - handbrake
    - intltool
    - libdvdcss
    - libreoffice-fresh
    - mkvtoolnix-gui
    - mtpfs
    - mtr
    - nfs-utils
    - ogmrip
    - perl-image-exiftool
    - rawtherapee
    - slack-desktop
    - simplescreenrecorder
    - transmission-gtk
    #- vagrant
    - vlc
    - wireshark-cli
    - wireshark-gtk

  - name: import keys needed for AUR packages
    gpg_import: key_id="{{ item }}" servers=pgp.mit.edu
    with_items:
    - "1EB2638FF56C0C53" # cower, needed for pacaur
    - "702353E0F7E48EDB" # ncurses5-compat-libs, needed for vmware-patch
    become: yes
    become_user: ken

  - name: build common AUR packages
    packer: name={{ item }}
    with_items:
    #- dpkg
    - dropbox
    - ledger
    - packer-io
    - spotify
    - thunar-dropbox
    - zoom

  - service: name=nfs-server enabled=yes

  handlers:
  - name: update pacman caches
    pacman: update_cache=yes
